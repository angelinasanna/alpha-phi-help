{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 22, "column": 0}, "map": {"version":3,"sources":["file:///Users/angelinasanna/my-sorority-bot/app/admin/page.js"],"sourcesContent":["// app/admin/page.js\n\"use client\";\n\nimport { SignedIn, SignedOut, SignInButton, useUser } from \"@clerk/nextjs\";\nimport { useEffect, useMemo, useState } from \"react\";\n\n// optional: allow admins via email env list or Clerk role\nfunction useIsAdmin() {\n  const { user } = useUser();\n  const email = user?.primaryEmailAddress?.emailAddress?.toLowerCase() || \"\";\n  const role = user?.publicMetadata?.role;\n  const allowed = (process.env.NEXT_PUBLIC_ADMIN_EMAILS || \"\")\n    .split(\",\")\n    .map(s => s.trim().toLowerCase())\n    .filter(Boolean);\n  return role === \"admin\" || allowed.includes(email);\n}\n\nexport default function AdminAllInOne() {\n  const isAdmin = useIsAdmin();\n\n  // Create form\n  const [content, setContent] = useState(\"\");\n  const [url, setUrl] = useState(\"\");\n  const [saving, setSaving] = useState(false);\n  const [saveMsg, setSaveMsg] = useState(\"\");\n\n  // List/search/pagination\n  const [q, setQ] = useState(\"\");\n  const [items, setItems] = useState([]);\n  const [total, setTotal] = useState(0);\n  const [offset, setOffset] = useState(0);\n  const [limit] = useState(20);\n  const [loading, setLoading] = useState(false);\n  const page = useMemo(() => Math.floor(offset / limit) + 1, [offset, limit]);\n\n  async function load() {\n    setLoading(true);\n    const res = await fetch(\n      `/api/admin/chunks?q=${encodeURIComponent(q)}&limit=${limit}&offset=${offset}`\n    );\n    const data = await res.json().catch(() => ({}));\n    if (res.ok) {\n      setItems(data.items || []);\n      setTotal(data.total || 0);\n    }\n    setLoading(false);\n  }\n\n  useEffect(() => {\n    load();\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [q, offset]);\n\n  async function createEntry() {\n    setSaveMsg(\"\");\n    if (!content.trim()) {\n      setSaveMsg(\"Please add some text first.\");\n      return;\n    }\n    setSaving(true);\n    try {\n      const res = await fetch(\"/api/admin/chunks\", {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify({ content, url: url || null }), // server defaults source\n      });\n      const data = await res.json().catch(() => ({}));\n      if (!res.ok) setSaveMsg(data.error || `Error ${res.status}`);\n      else {\n        setSaveMsg(\"Saved!\");\n        setContent(\"\");\n        setUrl(\"\");\n        setOffset(0);\n        load();\n      }\n    } catch {\n      setSaveMsg(\"Network error — try again.\");\n    } finally {\n      setSaving(false);\n    }\n  }\n\n  async function saveEdit(row) {\n    const res = await fetch(`/api/admin/chunks/${row.id}`, {\n      method: \"PATCH\",\n      headers: { \"Content-Type\": \"application/json\" },\n      body: JSON.stringify({ content: row.content, url: row.url ?? null }), // only content+url\n    });\n    if (res.ok) load();\n    else alert((await res.json()).error || \"Error saving\");\n  }\n\n  async function del(id) {\n    if (!confirm(\"Delete this entry?\")) return;\n    const res = await fetch(`/api/admin/chunks/${id}`, { method: \"DELETE\" });\n    if (res.ok) load();\n    else alert((await res.json()).error || \"Error deleting\");\n  }\n\n  function Row({ row }) {\n    const [edit, setEdit] = useState(false);\n    const [draft, setDraft] = useState(row);\n\n    return (\n      <div className=\"border rounded p-3 bg-white/70\">\n        {edit ? (\n          <>\n            {/* Editable content */}\n            <textarea\n              className=\"border rounded px-2 py-1 w-full min-h-[120px]\"\n              value={draft.content}\n              onChange={(e) => setDraft({ ...draft, content: e.target.value })}\n            />\n            {/* Optional URL */}\n            <input\n              className=\"border rounded px-2 py-1 w-full mt-2\"\n              value={draft.url || \"\"}\n              onChange={(e) => setDraft({ ...draft, url: e.target.value })}\n              placeholder=\"Optional URL\"\n            />\n            <div className=\"mt-2 flex gap-2\">\n              <button\n                className=\"px-3 py-1 rounded bg-[#7a1f3d] text-white\"\n                onClick={async () => {\n                  await saveEdit(draft);\n                  setEdit(false);\n                }}\n              >\n                Save\n              </button>\n              <button\n                className=\"px-3 py-1 rounded border\"\n                onClick={() => {\n                  setDraft(row);\n                  setEdit(false);\n                }}\n              >\n                Cancel\n              </button>\n            </div>\n          </>\n        ) : (\n          <>\n            <div className=\"text-sm text-gray-500\">\n              {new Date(row.created_at).toLocaleString()}\n            </div>\n            {row.url && (\n              <a className=\"underline text-sm\" href={row.url} target=\"_blank\">\n                {row.url}\n              </a>\n            )}\n            <p className=\"mt-2 whitespace-pre-wrap\">{row.content}</p>\n            <div className=\"mt-2 flex gap-2\">\n              <button className=\"px-3 py-1 rounded border\" onClick={() => setEdit(true)}>\n                Edit\n              </button>\n              <button\n                className=\"px-3 py-1 rounded border text-red-600\"\n                onClick={() => del(row.id)}\n              >\n                Delete\n              </button>\n            </div>\n          </>\n        )}\n      </div>\n    );\n  }\n\n  return (\n    <main className=\"max-w-3xl mx-auto p-6 space-y-6\">\n      <h1 className=\"text-2xl font-bold\">Add Info!</h1>\n\n      <SignedOut>\n        <div className=\"p-4 border rounded bg-white/70\">\n          Members only — <SignInButton>sign in</SignInButton>.\n        </div>\n      </SignedOut>\n\n      <SignedIn>\n        {!isAdmin ? (\n          <div className=\"p-4 border rounded bg-white/70\">Admins only.</div>\n        ) : (\n          <>\n            {/* Create form */}\n            <section className=\"space-y-2 border rounded p-4 bg-white/70\">\n              <textarea\n                className=\"w-full border rounded px-3 py-2 min-h-[160px]\"\n                placeholder=\"Paste info, event details, policy, etc…\"\n                value={content}\n                onChange={(e) => setContent(e.target.value)}\n              />\n              <input\n                className=\"w-full border rounded px-3 py-2\"\n                placeholder=\"Optional URL\"\n                value={url}\n                onChange={(e) => setUrl(e.target.value)}\n              />\n              <div className=\"flex items-center gap-3\">\n                <button\n                  onClick={createEntry}\n                  disabled={saving}\n                  className=\"px-4 py-2 rounded bg-[#7a1f3d] text-white disabled:opacity-60\"\n                >\n                  {saving ? \"Saving…\" : \"Save\"}\n                </button>\n                {saveMsg && <span className=\"text-sm\">{saveMsg}</span>}\n              </div>\n              <p className=\"text-xs text-gray-600\">\n                Tip: one topic per entry; include words members will search (e.g., “dues”, “big/little”, \"dates\").\n              </p>\n            </section>\n\n            {/* Search box */}\n            <div className=\"flex gap-2 items-center\">\n              <input\n                className=\"border rounded px-3 py-2 w-full\"\n                placeholder=\"Search entries by text…\"\n                value={q}\n                onChange={(e) => {\n                  setOffset(0);\n                  setQ(e.target.value);\n                }}\n              />\n              {loading && <span className=\"text-sm text-gray-600\">Loading…</span>}\n            </div>\n\n            {/* Results */}\n            <div className=\"grid gap-3\">\n              {items.map((row) => (\n                <Row key={row.id} row={row} />\n              ))}\n              {!loading && items.length === 0 && (\n                <div className=\"text-sm text-gray-600\">No results.</div>\n              )}\n            </div>\n\n            {/* Pagination */}\n            <div className=\"flex items-center gap-3 pt-2\">\n              <button\n                className=\"px-3 py-1 rounded border disabled:opacity-50\"\n                onClick={() => setOffset(Math.max(0, offset - limit))}\n                disabled={offset === 0}\n              >\n                Prev\n              </button>\n              <span className=\"text-sm\">\n                Page {page} · {total} total\n              </span>\n              <button\n                className=\"px-3 py-1 rounded border disabled:opacity-50\"\n                onClick={() => setOffset(offset + limit)}\n                disabled={offset + limit >= total}\n              >\n                Next\n              </button>\n            </div>\n          </>\n        )}\n      </SignedIn>\n    </main>\n  );\n}\n"],"names":[],"mappings":"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","debugId":null}}]
}