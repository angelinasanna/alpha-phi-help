{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 22, "column": 0}, "map": {"version":3,"sources":["file:///Users/angelinasanna/my-sorority-bot/app/admin/manage/page.js"],"sourcesContent":["// app/admin/manage/page.js\n\"use client\";\nimport { SignedIn, SignedOut, SignInButton, useUser } from \"@clerk/nextjs\";\nimport { useEffect, useMemo, useState } from \"react\";\n\nfunction useIsAdmin() {\n  const { user } = useUser();\n  const email = user?.primaryEmailAddress?.emailAddress?.toLowerCase() || \"\";\n  const role = user?.publicMetadata?.role;\n  const allowed = (process.env.NEXT_PUBLIC_ADMIN_EMAILS || \"\")\n    .split(\",\").map(s => s.trim().toLowerCase()).filter(Boolean);\n  return role === \"admin\" || allowed.includes(email);\n}\n\nexport default function ManageChunks() {\n  const isAdmin = useIsAdmin();\n  const [q, setQ] = useState(\"\");\n  const [items, setItems] = useState([]);\n  const [total, setTotal] = useState(0);\n  const [offset, setOffset] = useState(0);\n  const [limit] = useState(20);\n  const [loading, setLoading] = useState(false);\n\n  const page = useMemo(() => Math.floor(offset / limit) + 1, [offset, limit]);\n\n  async function load() {\n    setLoading(true);\n    const res = await fetch(`/api/admin/chunks?q=${encodeURIComponent(q)}&limit=${limit}&offset=${offset}`);\n    const data = await res.json().catch(()=>({}));\n    if (res.ok) {\n      setItems(data.items || []);\n      setTotal(data.total || 0);\n    }\n    setLoading(false);\n  }\n\n  useEffect(() => { load(); /* eslint-disable-next-line */ }, [q, offset]);\n\n  async function saveEdit(row) {\n    const res = await fetch(`/api/admin/chunks/${row.id}`, {\n      method: \"PATCH\",\n      headers: { \"Content-Type\": \"application/json\" },\n      body: JSON.stringify({ content: row.content, source: row.source, url: row.url ?? null }),\n    });\n    if (res.ok) load();\n    else alert((await res.json()).error || \"Error saving\");\n  }\n\n  async function del(id) {\n    if (!confirm(\"Delete this entry?\")) return;\n    const res = await fetch(`/api/admin/chunks/${id}`, { method: \"DELETE\" });\n    if (res.ok) load(); else alert((await res.json()).error || \"Error deleting\");\n  }\n\n  // simple inline editing\n  function Row({ row }) {\n    const [edit, setEdit] = useState(false);\n    const [draft, setDraft] = useState(row);\n    return (\n      <div className=\"border rounded p-3 bg-white/70\">\n        {edit ? (\n          <>\n            <div className=\"flex gap-2 mb-2\">\n              <input className=\"border rounded px-2 py-1 flex-1\"\n                value={draft.source || \"\"} onChange={(e)=>setDraft({...draft, source:e.target.value})}\n                placeholder=\"Source (FAQ, Handbook…)\" />\n              <input className=\"border rounded px-2 py-1 flex-1\"\n                value={draft.url || \"\"} onChange={(e)=>setDraft({...draft, url:e.target.value})}\n                placeholder=\"Optional URL\" />\n            </div>\n            <textarea className=\"border rounded px-2 py-1 w-full min-h-[120px]\"\n              value={draft.content} onChange={(e)=>setDraft({...draft, content:e.target.value})}/>\n            <div className=\"mt-2 flex gap-2\">\n              <button className=\"px-3 py-1 rounded bg-[#7a1f3d] text-white\"\n                onClick={async()=>{ await saveEdit(draft); setEdit(false); }}>\n                Save\n              </button>\n              <button className=\"px-3 py-1 rounded border\" onClick={()=>{ setDraft(row); setEdit(false); }}>\n                Cancel\n              </button>\n            </div>\n          </>\n        ) : (\n          <>\n            <div className=\"text-sm text-gray-500\">\n              {row.source || \"source\"} · {new Date(row.created_at).toLocaleString()}\n            </div>\n            {row.url && <a className=\"underline text-sm\" href={row.url} target=\"_blank\">{row.url}</a>}\n            <p className=\"mt-2 whitespace-pre-wrap\">{row.content}</p>\n            <div className=\"mt-2 flex gap-2\">\n              <button className=\"px-3 py-1 rounded border\" onClick={()=>setEdit(true)}>Edit</button>\n              <button className=\"px-3 py-1 rounded border text-red-600\" onClick={()=>del(row.id)}>Delete</button>\n            </div>\n          </>\n        )}\n      </div>\n    );\n  }\n\n  return (\n    <main className=\"max-w-3xl mx-auto p-6 space-y-4\">\n      <h1 className=\"text-2xl font-semibold\">Admin: manage knowledge</h1>\n\n      <SignedOut>\n        <div className=\"p-4 border rounded bg-white/70\">\n          Members only — <SignInButton>sign in</SignInButton>.\n        </div>\n      </SignedOut>\n\n      <SignedIn>\n        {!isAdmin ? (\n          <div className=\"p-4 border rounded bg-white/70\">Admins only.</div>\n        ) : (\n          <>\n            <input\n              className=\"border rounded px-3 py-2 w-full\"\n              placeholder=\"Search by text or source…\"\n              value={q}\n              onChange={(e) => { setOffset(0); setQ(e.target.value); }}\n            />\n\n            {loading && <div className=\"text-sm\">Loading…</div>}\n\n            <div className=\"grid gap-3\">\n              {items.map((row) => <Row key={row.id} row={row} />)}\n              {!loading && items.length === 0 && <div className=\"text-sm text-gray-600\">No results.</div>}\n            </div>\n\n            <div className=\"flex items-center gap-3 pt-2\">\n              <button\n                className=\"px-3 py-1 rounded border disabled:opacity-50\"\n                onClick={() => setOffset(Math.max(0, offset - limit))}\n                disabled={offset === 0}\n              >Prev</button>\n              <span className=\"text-sm\">Page {page} · {total} total</span>\n              <button\n                className=\"px-3 py-1 rounded border disabled:opacity-50\"\n                onClick={() => setOffset(offset + limit)}\n                disabled={offset + limit >= total}\n              >Next</button>\n            </div>\n          </>\n        )}\n      </SignedIn>\n    </main>\n  );\n}\n"],"names":[],"mappings":"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","debugId":null}}]
}