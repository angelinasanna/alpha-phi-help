{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 3, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"","debugId":null}},
    {"offset": {"line": 103, "column": 0}, "map": {"version":3,"sources":["file:///Users/angelinasanna/my-sorority-bot/app/api/admin/%5Bid%5D/route.js"],"sourcesContent":["// app/api/admin/chunks/[id]/route.js\nimport { auth, currentUser } from \"@clerk/nextjs/server\";\nimport { createClient } from \"@supabase/supabase-js\";\n\nfunction isEmailAdmin(email) {\n  const list = (process.env.ADMIN_EMAILS || process.env.NEXT_PUBLIC_ADMIN_EMAILS || \"\")\n    .split(\",\").map(s => s.trim().toLowerCase()).filter(Boolean);\n  return list.includes((email || \"\").toLowerCase());\n}\nasync function requireAdmin() {\n  const { userId } = await auth();\n  if (!userId) throw new Response(\"Unauthorized\", { status: 401 });\n  const user = await currentUser();\n  const email = user?.primaryEmailAddress?.emailAddress;\n  const role = user?.publicMetadata?.role;\n  if (!(role === \"admin\" || isEmailAdmin(email))) throw new Response(\"Forbidden\", { status: 403 });\n}\nfunction supa() {\n  return createClient(\n    process.env.NEXT_PUBLIC_SUPABASE_URL,\n    process.env.SUPABASE_SERVICE_ROLE,\n    { auth: { persistSession: false } }\n  );\n}\n\nexport async function PATCH(req, { params }) {\n  try {\n    await requireAdmin();\n    const id = params.id;\n    const body = await req.json();\n    const { content, source, url } = body;\n\n    let update = { updated_at: new Date().toISOString() };\n    if (typeof source === \"string\") update.source = source;\n    if (typeof url === \"string\" || url === null) update.url = url;\n\n    // if content changed, re-embed (Voyage)\n    if (typeof content === \"string\") {\n      update.content = content;\n\n      const model = process.env.EMBED_MODEL || \"voyage-3.5-lite\";\n      const vRes = await fetch(\"https://api.voyageai.com/v1/embeddings\", {\n        method: \"POST\",\n        headers: {\n          \"Authorization\": `Bearer ${process.env.VOYAGE_API_KEY}`,\n          \"Content-Type\": \"application/json\",\n        },\n        body: JSON.stringify({ model, input: content, input_type: \"document\" }),\n      });\n      if (!vRes.ok) return Response.json({ error: await vRes.text() }, { status: vRes.status });\n      const v = await vRes.json();\n      update.embedding_voyage = v?.data?.[0]?.embedding;\n    }\n\n    const { error } = await supa().from(\"chunks\").update(update).eq(\"id\", id);\n    if (error) return Response.json({ error: error.message }, { status: 500 });\n    return Response.json({ ok: true });\n  } catch (e) {\n    if (e instanceof Response) return e;\n    return Response.json({ error: e.message }, { status: 500 });\n  }\n}\n\nexport async function DELETE(_req, { params }) {\n  try {\n    await requireAdmin();\n    const id = params.id;\n    const { error } = await supa().from(\"chunks\").delete().eq(\"id\", id);\n    if (error) return Response.json({ error: error.message }, { status: 500 });\n    return Response.json({ ok: true });\n  } catch (e) {\n    if (e instanceof Response) return e;\n    return Response.json({ error: e.message }, { status: 500 });\n  }\n}\n"],"names":[],"mappings":"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","debugId":null}}]
}