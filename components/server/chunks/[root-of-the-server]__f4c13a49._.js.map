{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 3, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"","debugId":null}},
    {"offset": {"line": 103, "column": 0}, "map": {"version":3,"sources":["file:///Users/angelinasanna/my-sorority-bot/app/api/admin/add-chunk/route.js"],"sourcesContent":["// app/api/admin/add-chunk/route.js\nimport { auth, currentUser } from \"@clerk/nextjs/server\";\nimport { createClient } from \"@supabase/supabase-js\";\nimport Groq from \"groq-sdk\"; // (not used here, but fine to keep if you want)\n                                   \nfunction isEmailAdmin(email) {\n  const list = (process.env.ADMIN_EMAILS || process.env.NEXT_PUBLIC_ADMIN_EMAILS || \"\")\n    .split(\",\").map(s => s.trim().toLowerCase()).filter(Boolean);\n  return list.includes((email || \"\").toLowerCase());\n}\n\nexport async function POST(req) {\n  const { userId } = await auth();\n  if (!userId) return new Response(\"Unauthorized\", { status: 401 });\n\n  const user = await currentUser();\n  const email = user?.primaryEmailAddress?.emailAddress;\n  const role = user?.publicMetadata?.role;\n  if (!(role === \"admin\" || isEmailAdmin(email))) {\n    return new Response(\"Forbidden\", { status: 403 });\n  }\n\n  try {\n    const { content, source = \"FAQ\", url = null } = await req.json();\n    if (!content?.trim()) return Response.json({ error: \"No content\" }, { status: 400 });\n\n    // --- Voyage embedding ---\n    if (!process.env.VOYAGE_API_KEY) {\n      return Response.json({ error: \"Missing VOYAGE_API_KEY\" }, { status: 500 });\n    }\n    const model = process.env.EMBED_MODEL || \"voyage-3.5-lite\";\n    const vRes = await fetch(\"https://api.voyageai.com/v1/embeddings\", {\n      method: \"POST\",\n      headers: {\n        \"Authorization\": `Bearer ${process.env.VOYAGE_API_KEY}`,\n        \"Content-Type\": \"application/json\",\n      },\n      body: JSON.stringify({\n        model,\n        input: content,          // a single string is fine\n        input_type: \"document\",  // good default for knowledge snippets\n      }),\n    });\n    if (!vRes.ok) {\n      const txt = await vRes.text();\n      return Response.json({ error: `Voyage error: ${vRes.status} ${txt}` }, { status: 500 });\n    }\n    const vJson = await vRes.json();\n    const vector = vJson?.data?.[0]?.embedding;\n\n    const supa = createClient(\n      process.env.NEXT_PUBLIC_SUPABASE_URL,\n      process.env.SUPABASE_SERVICE_ROLE,\n      { auth: { persistSession: false } }\n    );\n\n    // insert into voyage column\n    const { error } = await supa.from(\"chunks\").insert({\n      content, source, url,\n      embedding_voyage: vector,\n    });\n    if (error) return Response.json({ error: error.message }, { status: 500 });\n\n    return Response.json({ ok: true });\n  } catch (e) {\n    return Response.json({ error: e.message }, { status: 500 });\n  }\n}\n"],"names":[],"mappings":"AAAA,mCAAmC;;;;;AACnC;AAAA;AACA;;;;AAGA,SAAS,aAAa,KAAK;IACzB,MAAM,OAAO,CAAC,QAAQ,GAAG,CAAC,YAAY,IAAI,QAAQ,GAAG,CAAC,wBAAwB,IAAI,EAAE,EACjF,KAAK,CAAC,KAAK,GAAG,CAAC,CAAA,IAAK,EAAE,IAAI,GAAG,WAAW,IAAI,MAAM,CAAC;IACtD,OAAO,KAAK,QAAQ,CAAC,CAAC,SAAS,EAAE,EAAE,WAAW;AAChD;AAEO,eAAe,KAAK,GAAG;IAC5B,MAAM,EAAE,MAAM,EAAE,GAAG,MAAM,IAAA,6LAAI;IAC7B,IAAI,CAAC,QAAQ,OAAO,IAAI,SAAS,gBAAgB;QAAE,QAAQ;IAAI;IAE/D,MAAM,OAAO,MAAM,IAAA,2MAAW;IAC9B,MAAM,QAAQ,MAAM,qBAAqB;IACzC,MAAM,OAAO,MAAM,gBAAgB;IACnC,IAAI,CAAC,CAAC,SAAS,WAAW,aAAa,MAAM,GAAG;QAC9C,OAAO,IAAI,SAAS,aAAa;YAAE,QAAQ;QAAI;IACjD;IAEA,IAAI;QACF,MAAM,EAAE,OAAO,EAAE,SAAS,KAAK,EAAE,MAAM,IAAI,EAAE,GAAG,MAAM,IAAI,IAAI;QAC9D,IAAI,CAAC,SAAS,QAAQ,OAAO,SAAS,IAAI,CAAC;YAAE,OAAO;QAAa,GAAG;YAAE,QAAQ;QAAI;QAElF,2BAA2B;QAC3B,IAAI,CAAC,QAAQ,GAAG,CAAC,cAAc,EAAE;YAC/B,OAAO,SAAS,IAAI,CAAC;gBAAE,OAAO;YAAyB,GAAG;gBAAE,QAAQ;YAAI;QAC1E;QACA,MAAM,QAAQ,QAAQ,GAAG,CAAC,WAAW,IAAI;QACzC,MAAM,OAAO,MAAM,MAAM,0CAA0C;YACjE,QAAQ;YACR,SAAS;gBACP,iBAAiB,CAAC,OAAO,EAAE,QAAQ,GAAG,CAAC,cAAc,EAAE;gBACvD,gBAAgB;YAClB;YACA,MAAM,KAAK,SAAS,CAAC;gBACnB;gBACA,OAAO;gBACP,YAAY;YACd;QACF;QACA,IAAI,CAAC,KAAK,EAAE,EAAE;YACZ,MAAM,MAAM,MAAM,KAAK,IAAI;YAC3B,OAAO,SAAS,IAAI,CAAC;gBAAE,OAAO,CAAC,cAAc,EAAE,KAAK,MAAM,CAAC,CAAC,EAAE,KAAK;YAAC,GAAG;gBAAE,QAAQ;YAAI;QACvF;QACA,MAAM,QAAQ,MAAM,KAAK,IAAI;QAC7B,MAAM,SAAS,OAAO,MAAM,CAAC,EAAE,EAAE;QAEjC,MAAM,OAAO,IAAA,yMAAY,gFAEvB,QAAQ,GAAG,CAAC,qBAAqB,EACjC;YAAE,MAAM;gBAAE,gBAAgB;YAAM;QAAE;QAGpC,4BAA4B;QAC5B,MAAM,EAAE,KAAK,EAAE,GAAG,MAAM,KAAK,IAAI,CAAC,UAAU,MAAM,CAAC;YACjD;YAAS;YAAQ;YACjB,kBAAkB;QACpB;QACA,IAAI,OAAO,OAAO,SAAS,IAAI,CAAC;YAAE,OAAO,MAAM,OAAO;QAAC,GAAG;YAAE,QAAQ;QAAI;QAExE,OAAO,SAAS,IAAI,CAAC;YAAE,IAAI;QAAK;IAClC,EAAE,OAAO,GAAG;QACV,OAAO,SAAS,IAAI,CAAC;YAAE,OAAO,EAAE,OAAO;QAAC,GAAG;YAAE,QAAQ;QAAI;IAC3D;AACF","debugId":null}}]
}